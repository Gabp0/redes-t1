#include "githyanki.h"
#include "connection.h"
#include "common.h"
#include <string>
#include <iostream>
#include <algorithm>

using namespace std;

bool cmdOptionExists(char **begin, char **end, const std::string &option)
{
        return std::find(begin, end, option) != end;
}

int main(int argc, char **argv)
{
        Connection serverCon("lo1");
        Connection clientCon("lo2");

        if (cmdOptionExists(argv, argv + argc, "-s"))
        {
                string text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum non dolor bibendum, tempor nisl eu, sagittis dui. Nullam augue tellus, consequat at nisl in, ultrices commodo felis. Quisque luctus metus lorem, quis iaculis metus semper nec. Etiam dui lectus, finibus vitae nulla et, cursus facilisis diam. Vestibulum tincidunt mauris in metus vestibulum, et pulvinar urna fringilla. Fusce eget arcu ut nunc dictum mattis nec sit amet tortor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Sed bibendum, sem venenatis rutrum tincidunt, lacus sem sagittis urna, ac consequat ex elit quis nibh.\nNam pretium felis et lacus venenatis cursus. Nullam convallis quam condimentum nisi blandit, eu consectetur ante fringilla. Mauris pharetra bibendum justo a commodo. Aliquam egestas ultrices turpis id hendrerit. Curabitur molestie nisi eget enim consequat, id vulputate velit rutrum. Suspendisse ut velit ut neque laoreet egestas id quis massa. Proin id convallis nulla.\nSed id tortor justo. Ut ut rutrum dolor. Vivamus quis leo orci. Vestibulum placerat sagittis vestibulum. Donec scelerisque sodales arcu cursus lacinia. Praesent sit amet metus non tellus consectetur vehicula vel ut neque. Maecenas sit amet tincidunt nibh. Integer a lacinia ligula. Cras sit amet odio vitae lorem tempus imperdiet.\nNullam commodo accumsan ligula, id ultricies erat. Fusce dignissim ut neque sit amet pellentesque. Vivamus blandit, arcu sit amet maximus pretium, justo orci luctus ligula, sit amet porttitor purus magna quis ex. Duis et ex et odio auctor gravida ut sed nulla. Nulla volutpat lectus ut urna aliquam, et rutrum elit vestibulum. In leo ex, pretium sit amet aliquam at, eleifend vitae lacus. Vivamus maximus nunc sapien, ut porttitor urna pretium et. Morbi id turpis ac urna eleifend hendrerit sit amet at tortor. Donec dapibus rutrum lacinia.\nMaecenas tempus scelerisque gravida. Donec non neque id tellus feugiat elementum. Nam sit amet purus at tortor varius sagittis. Nulla pulvinar elit nec purus porta, scelerisque feugiat velit porta. Aliquam laoreet scelerisque est in egestas. Donec et velit interdum, hendrerit leo mollis, tincidunt neque. Curabitur non nisl euismod, suscipit augue sed, dictum quam. Mauris tristique, elit vitae elementum tincidunt, nulla purus ultrices nulla, sit amet egestas arcu felis id urna.\nCras porttitor purus id dui elementum, vitae dictum tortor rhoncus. Nullam quis tristique purus, sit amet imperdiet odio. Vivamus non vehicula ipsum. Nunc tellus arcu, commodo ut arcu ac, imperdiet semper lacus. In molestie lacus eget elit cursus iaculis. Sed mollis sapien leo. Interdum et malesuada fames ac ante ipsum primis in faucibus. Phasellus enim lacus, luctus vel semper ut, mattis a velit. Donec fringilla nisi mi, vel vehicula felis iaculis non. Nullam consectetur urna id eros molestie, in bibendum felis sagittis. Phasellus non purus dictum, ornare odio iaculis, euismod neque. Etiam interdum ex id ultricies aliquam. Integer aliquam justo ut lacinia dignissim. Donec laoreet volutpat nibh eget molestie.\nUt id ex et felis sollicitudin mattis eu non ligula. Praesent volutpat diam id mauris ultrices, ac vulputate lectus rhoncus. Ut vel turpis et eros lobortis auctor luctus non ligula. Sed tincidunt efficitur faucibus. Donec dictum porta eros, vel dictum diam. Morbi luctus velit diam, eu scelerisque libero tincidunt ac. Nulla eu turpis et ipsum iaculis pharetra. Quisque nec suscipit metus. Aenean venenatis justo ipsum, quis placerat turpis condimentum et. Cras eu ipsum mattis, viverra ex vel, rutrum massa. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nulla pretium consectetur mattis. Etiam gravida quam at elit molestie lobortis. Morbi et tincidunt neque, ut pellentesque eros. Etiam lorem massa, laoreet et nibh vitae, euismod luctus dolor. Nunc efficitur lacus bibendum facilisis euismod.\nCurabitur id libero est. Ut rutrum elementum accumsan. Pellentesque tristique mollis libero. Donec congue tortor ut risus rutrum, eget volutpat leo varius. Cras velit elit, faucibus id libero et, pretium consectetur nisl. Cras iaculis, urna in tempor euismod, nisl tellus varius nisi, vel tincidunt magna sem in orci. Quisque gravida commodo ullamcorper.\nNam placerat quis nisl sed porta. Aliquam porta eu nisi sed tristique. Donec posuere pharetra sem vitae placerat. Vivamus eget varius tellus. Donec ac augue ac dui sodales commodo quis id enim. Sed rutrum eleifend vulputate. Morbi vel luctus nisi, ut faucibus ipsum. Integer lobortis malesuada finibus.\nNam non nisi vel turpis lacinia hendrerit vel quis orci. Nullam porta risus purus, ut aliquet urna commodo a. Fusce a convallis arcu. Integer egestas mauris purus, aliquet rhoncus purus iaculis vitae. Fusce sed feugiat justo. Fusce mattis magna in pulvinar sodales. Cras aliquam est vitae ornare dignissim. Pellentesque elementum, felis eu luctus gravida, nibh lectus eleifend neque, eu tempus nulla massa sit amet erat.\nNunc egestas efficitur purus, non laoreet velit fringilla sed. Vivamus accumsan magna at massa semper facilisis. Suspendisse sagittis pretium justo ac feugiat. Quisque suscipit, quam ut molestie tempus, arcu lorem rutrum velit, at interdum neque turpis non mi. Nullam id ex vehicula, vulputate elit in, efficitur sapien. Proin eu leo eros. Vivamus eget ultricies mi. Aliquam scelerisque sem nec lacus semper, ut vestibulum orci molestie. Sed gravida pharetra augue, eu commodo ex pretium vitae. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Cras dapibus nisi finibus, ullamcorper mi nec, sodales quam. Integer nisl odio, condimentum rutrum augue eu, volutpat ornare ipsum. Aliquam enim elit, venenatis vel diam sit amet, maximus condimentum purus.\nPraesent rhoncus volutpat libero ut tristique. Curabitur quis dui venenatis, dictum elit sed, hendrerit eros. Aliquam vel viverra metus. Suspendisse vulputate est a eleifend fermentum. Pellentesque sit amet porttitor nibh, non lacinia metus. Maecenas sit amet lorem laoreet, ornare augue a, ullamcorper magna. In consectetur congue malesuada. Ut leo lacus, aliquam eu ornare nec, condimentum sed nulla. Sed malesuada nisi vel tincidunt fermentum. Aenean ac tortor sapien.\nFusce non turpis non purus bibendum venenatis non quis dolor. Maecenas pulvinar pretium cursus. Nulla aliquam ac ligula sit amet congue. Aliquam laoreet quis purus vitae rutrum. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Praesent vehicula purus sed ex accumsan viverra. Vestibulum sed sagittis massa.\nNunc sagittis consectetur lorem sed pretium. Morbi metus risus, tincidunt quis lacus quis, cursus ornare velit. Etiam quis augue turpis. Curabitur a pulvinar dui. Donec ac dui convallis, congue eros iaculis, dapibus arcu. Pellentesque velit neque, pretium sit amet suscipit vitae, sodales quis lectus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Pellentesque et consectetur leo. Pellentesque nec feugiat tortor. Aenean sem metus, convallis sed sem eget, efficitur vestibulum massa.\nDonec fringilla, nulla eu pretium molestie, diam purus tempor eros, sit amet iaculis orci dolor vel felis. Cras eleifend dui et ultricies elementum. Integer imperdiet tincidunt velit ut sollicitudin. Nunc sagittis tellus eu sem vehicula vestibulum. Nam sit amet ante id libero egestas hendrerit id ac justo. Nulla aliquet, sem condimentum iaculis euismod, erat eros accumsan augue, nec feugiat turpis ipsum quis sapien. Nam tincidunt ut urna rutrum iaculis. Cras justo quam, accumsan ac arcu egestas, ullamcorper dapibus nibh. Interdum et malesuada fames ac ante ipsum primis in faucibus. Cras euismod sodales turpis, a lobortis justo. Praesent id auctor purus. Suspendisse potenti. Suspendisse ac viverra nibh. Cras eget vehicula arcu. Aliquam auctor sem ac porta dictum. Donec nec vestibulum magna.\nAenean imperdiet est elit, at porta urna pretium sed. Sed blandit enim arcu, accumsan pretium leo pretium eu. Mauris auctor aliquam velit ut dapibus. Phasellus laoreet cursus nulla fermentum bibendum. Nunc porta magna velit, quis commodo erat lobortis vitae. Ut sit amet fermentum quam, tempus posuere sapien. Proin risus diam, fringilla vitae faucibus nec, egestas et urna. Sed gravida pellentesque leo iaculis facilisis. Ut eu eleifend neque. Phasellus ut dapibus dolor. Sed congue posuere tellus.\nAenean sit amet rhoncus erat. Donec tincidunt posuere felis quis congue. Donec ultricies, turpis vel tristique tempor, quam lorem venenatis diam, ut blandit dolor mauris in ex. Duis ut neque turpis. Mauris rhoncus consequat nunc nec iaculis. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Mauris vel purus nulla. Aliquam hendrerit risus viverra, molestie turpis eu, tempor nunc. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Cras quis risus gravida, fringilla magna et, consectetur quam.\nDonec eget magna tincidunt, commodo lorem vel, ultrices massa. Proin blandit ac odio ac facilisis. Pellentesque rutrum odio id nunc tincidunt, eu sollicitudin lectus ornare. In hac habitasse platea dictumst. Nullam tincidunt dolor et velit vehicula sagittis. Phasellus arcu nisi, mattis quis augue eget, luctus ultrices turpis. Mauris ac est congue, scelerisque enim eu, faucibus massa. Fusce ut eleifend odio. Morbi auctor dolor vel mi suscipit, commodo feugiat diam elementum. Cras tristique nunc non ullamcorper fermentum. Duis faucibus ultricies sem, vitae porta velit. Aenean pellentesque laoreet nisi vel feugiat. Aliquam et urna magna. Nunc nec diam nec ante laoreet pretium. Aenean vitae scelerisque dui.\nEtiam turpis metus, aliquam non posuere eu, condimentum sed risus. In ut eros vel odio tempus eleifend in sit amet augue. Vestibulum congue, massa feugiat placerat pretium, lacus eros elementum elit, in ultricies mi sapien sodales lorem. Ut non sapien enim. Aliquam ligula.";
                Githyanki::DataObject msg = {};
                msg.data = text.data();
                msg.type = Githyanki::TEXT;
                msg.myCon = &serverCon;
                msg.otherCon = &clientCon;
                msg.size = text.size();
                msg.bytesFramed = 0;

                common::initLog("logs/serverLog.bin");

                Githyanki::SlidingWindowSend(&msg);
        }
        else if (cmdOptionExists(argv, argv + argc, "-r"))
        {
                common::initLog("logs/clientLog.bin");
                Githyanki::SlidingWindowReceive(&clientCon, &serverCon);
        }

        return 0;
}
